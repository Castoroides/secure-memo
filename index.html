<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Secure Memo</title>
  <!-- favicon -->
  <link rel="icon" href="https://pbs.twimg.com/profile_images/1990063014457053185/J0CJwbSv_400x400.jpg">

  <!-- Google Tag Manager -->
  <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
  new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
  j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
  'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
  })(window,document,'script','dataLayer','GTM-TPKXSNK3');</script>
  <!-- End Google Tag Manager -->

<style>
* {
  box-sizing: border-box;
}

body {
  margin: 0;
  font-family: system-ui, -apple-system, "Segoe UI", sans-serif;
  background: #f2f2f2;
  height: 100dvh;
}

/* å…¨ä½“ */
.container {
  max-width: 900px;
  margin: 0 auto;
  background: #fff;
  min-height: 100dvh;
  display: flex;
  flex-direction: column;
  padding: 12px;
}

.google-btn {
  display: flex;
  align-items: center;
  gap: 10px;
  background: #fff;
  color: #444;
  border: 1px solid #ddd;
  padding: 10px 14px;
  border-radius: 10px;
  cursor: pointer;
  font-size: 14px;
}

.google-btn svg {
  width: 20px;
  height: 20px;
}

/* ãƒ­ã‚°ã‚¤ãƒ³ãƒãƒ¼ */
.loginbar {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 10px;
  font-size: 14px;
}

/* ãƒ†ã‚­ã‚¹ãƒˆã‚¨ãƒªã‚¢å…±é€š */
textarea {
  width: 100%;
  border-radius: 10px;
  border: 1px solid #ccc;
  padding: 14px;
  font-size: 16px;   /* â† ã‚¹ãƒãƒ›æœ€é©ã‚µã‚¤ã‚º */
  line-height: 1.7;
  font-family: inherit;
  resize: none;
  overflow: auto;
}

/* ãƒ€ãƒŸãƒ¼å…ƒ */
#dummySource {
  height: 120px;
  margin-bottom: 10px;
}

/* ãƒ„ãƒ¼ãƒ«ãƒãƒ¼ */
.toolbar {
  display: flex;
  gap: 10px;
  margin-bottom: 10px;
}

.toolbar button {
  border: none;
  background: #18a2bd;
  color: #fff;
  padding: 12px 14px;
  border-radius: 10px;
  cursor: pointer;
  font-size: 15px;
  user-select: none;
  -webkit-user-select: none;
  touch-action: manipulation;
}

.toolbar button:active {
  transform: scale(0.96);
  background: #148aa2;
}

/* ã‚¨ãƒ‡ã‚£ã‚¿æ ï¼šç”»é¢ä¸‹ã¾ã§ä¼¸ã³ã‚‹ */
.editor-wrap {
  position: relative;
  flex: 1;                /* â† ã“ã‚ŒãŒé‡è¦ */
  border-radius: 12px;
  overflow: hidden;
  border: 1px solid #ccc;
  background: #fff;
  min-height: 200px;
}

/* è¡¨ç¤ºç”¨ */
#display {
  position: absolute;
  inset: 0;
  z-index: 1;
  border: none;
  background: #fafafa;
}

/* å…¥åŠ›ç”¨ */
#input {
  position: absolute;
  inset: 0;
  z-index: 2;
  border: none;
  background: transparent;
  color: transparent;
  caret-color: black;
}

/* =========================
   ğŸ’» PCã®ã¨ãã ã‘ä¸­å¤®å¯„ã›ï¼†ä½™ç™½
========================= */
@media (min-width: 900px) {
  .container {
    margin: 16px auto;
    border-radius: 12px;
    min-height: calc(100dvh - 32px);
    box-shadow: 0 4px 16px rgba(0,0,0,0.12);
  }
}
</style>
</head>
<body>
  <!-- Google Tag Manager (noscript) -->
  <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-TPKXSNK3"
  height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
  <!-- End Google Tag Manager (noscript) -->

<div class="container">

  <div class="loginbar">
    <div id="userLabel">ãƒ­ã‚°ã‚¤ãƒ³ã™ã‚‹ã“ã¨ã§ã€å…¥åŠ›ã—ãŸãƒ‡ãƒ¼ã‚¿ã‚’ä¿æŒã•ã›ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚ï¼ˆç¾åœ¨ æœªãƒ­ã‚°ã‚¤ãƒ³ï¼‰</div>
    <button id="loginBtn" class="google-btn">
  <svg viewBox="0 0 48 48">
    <path fill="#FFC107" d="M43.6 20.5H42V20H24v8h11.3C33.7 32.7 29.3 36 24 36c-6.6 0-12-5.4-12-12s5.4-12 12-12c3.1 0 5.9 1.2 8 3.2l5.7-5.7C34.2 6.1 29.4 4 24 4 12.9 4 4 12.9 4 24s8.9 20 20 20 20-8.9 20-20c0-1.3-.1-2.2-.4-3.5z"/>
    <path fill="#FF3D00" d="M6.3 14.7l6.6 4.8C14.7 16.1 19 12 24 12c3.1 0 5.9 1.2 8 3.2l5.7-5.7C34.2 6.1 29.4 4 24 4c-7.7 0-14.3 4.3-17.7 10.7z"/>
    <path fill="#4CAF50" d="M24 44c5.2 0 10-1.9 13.6-5.1l-6.3-5.2C29.3 36 24 36 24 36c-5.3 0-9.8-3.4-11.4-8.1l-6.5 5C9.4 39.6 16.2 44 24 44z"/>
    <path fill="#1976D2" d="M43.6 20.5H42V20H24v8h11.3c-1.1 3-3.4 5.4-6.3 6.9l.1.1 6.3 5.2C34.9 41 44 36 44 24c0-1.3-.1-2.2-.4-3.5z"/>
  </svg>
  <span>Sign in with Google</span>
</button>
  </div>

  <textarea id="dummySource" placeholder="ãƒ€ãƒŸãƒ¼è¡¨ç¤ºç”¨ãƒ†ã‚­ã‚¹ãƒˆ"></textarea>

  <div class="toolbar">
    <button id="toggleBtn">ğŸ‘ è¡¨ç¤º</button>
    <button id="copyBtn">ğŸ“‹ ã‚³ãƒ”ãƒ¼</button>
  </div>

  <div class="editor-wrap">
    <textarea id="display" readonly></textarea>
    <textarea id="input"></textarea>
  </div>

</div>

<!-- Firebase SDK -->
<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
import { getAuth, GoogleAuthProvider, signInWithPopup, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";
import { getFirestore, doc, setDoc, getDoc } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

/* =======================
   Firebase è¨­å®šï¼ˆã‚ãªãŸã®ï¼‰
======================= */
const firebaseConfig = {
  apiKey: "AIzaSyBPeOPcaf1WOsnbKA1I5FlrjAXm6tTkGy0",
  authDomain: "memo-bycastoroides.firebaseapp.com",
  projectId: "memo-bycastoroides",
  storageBucket: "memo-bycastoroides.firebasestorage.app",
  messagingSenderId: "833306576570",
  appId: "1:833306576570:web:18122e2541d061e2912483",
  measurementId: "G-3KE0Z8M5DD"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);

/* =======================
   UIè¦ç´ 
======================= */
const dummySource = document.getElementById("dummySource");
const display = document.getElementById("display");
const input = document.getElementById("input");
const toggleBtn = document.getElementById("toggleBtn");
const copyBtn = document.getElementById("copyBtn");
const loginBtn = document.getElementById("loginBtn");
const userLabel = document.getElementById("userLabel");

/* =======================
   ãƒ­ã‚°ã‚¤ãƒ³
======================= */
let currentUser = null;

loginBtn.onclick = async () => {
  const provider = new GoogleAuthProvider();
  await signInWithPopup(auth, provider);
};

onAuthStateChanged(auth, async (user) => {
  if (!user) return;
  currentUser = user;
  userLabel.textContent = user.email;
  loginBtn.style.display = "none";
  await loadFromCloud();
});

/* =======================
   ã‚¯ãƒ©ã‚¦ãƒ‰ä¿å­˜
======================= */
async function saveToCloud() {
  if (!currentUser) return;
  const ref = doc(db, "memos", currentUser.uid);
  await setDoc(ref, {
    real: input.value,
    dummy: dummySource.value,
    updated: Date.now()
  });
}

async function loadFromCloud() {
  const ref = doc(db, "memos", currentUser.uid);
  const snap = await getDoc(ref);
  if (snap.exists()) {
    const data = snap.data();
    input.value = data.real || "";
    dummySource.value = data.dummy || "";
    render(false);
  }
}

/* =======================
   ãƒ€ãƒŸãƒ¼è¡¨ç¤ºãƒ­ã‚¸ãƒƒã‚¯
======================= */
const REVEAL_COUNT = 3;
const REVEAL_TIME = 600;
let revealTimer = null;
let showReal = false;

function buildDummyStream() {
  const src = dummySource.value || "ã“ã‚Œã¯æ™®é€šã®ãƒ¡ãƒ¢ã§ã™ã€‚";
  const cleaned = src.replace(/\s+/g, "");
  return cleaned.repeat(200);
}

function render(revealTail = false) {
  const realText = input.value;
  const len = realText.length;

  if (showReal) {
    display.value = realText;
    return;
  }

  if (len === 0) {
    display.value = "";
    return;
  }

  const dummyStream = buildDummyStream();
  let masked = dummyStream.slice(0, len);

  if (revealTail) {
    const n = Math.min(REVEAL_COUNT, len);
    masked =
      dummyStream.slice(0, len - n) +
      realText.slice(len - n);
  }

  display.value = masked;
}

/* =======================
   ã‚¤ãƒ™ãƒ³ãƒˆ
======================= */
input.addEventListener("input", () => {
  render(true);
  saveToCloud();

  clearTimeout(revealTimer);
  revealTimer = setTimeout(() => render(false), REVEAL_TIME);
});

input.addEventListener("scroll", () => {
  display.scrollTop = input.scrollTop;
});

dummySource.addEventListener("input", () => {
  render(false);
  saveToCloud();
});

toggleBtn.addEventListener("pointerdown", () => {
  showReal = true;
  display.value = input.value;
});

toggleBtn.addEventListener("pointerup", () => {
  showReal = false;
  render(false);
});

toggleBtn.addEventListener("pointerleave", () => {
  showReal = false;
  render(false);
});


</script>

</body>
</html>
